<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Header moderne -->
    <header class="modern-header">
        <div class="header-left">
            <div class="logo-modern">
                <i class="fab fa-spotify"></i>
                <span>Spootify</span>
                <span class="version">v2.0</span>
            </div>
        </div>
        
        <div class="header-center">
            <div class="global-search">
                <i class="fas fa-search"></i>
                <input type="text" id="global-search" placeholder="Rechercher dans Spotify et votre bibliothèque...">
                <div class="search-filters-toggle">
                    <button id="search-filter-btn" class="filter-toggle">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="header-actions">
                <button class="header-btn" id="upload-btn" title="Ajouter de la musique">
                    <i class="fas fa-cloud-upload-alt"></i>
                </button>
                <button class="header-btn" id="help-btn" title="Aide et dépannage">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="header-btn" id="settings-btn" title="Paramètres">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="user-menu">
                    <% if (user) { %>
                        <div class="user-avatar-container">
                            <% if (user.images && user.images.length > 0) { %>
                                <img src="<%= user.images[0].url %>" alt="Avatar" class="user-avatar-modern">
                            <% } else { %>
                                <div class="user-avatar-placeholder-modern">
                                    <i class="fas fa-user"></i>
                                </div>
                            <% } %>
                            <div class="user-dropdown">
                                <div class="user-info-dropdown">
                                    <span class="user-name"><%= user.display_name || user.id %></span>
                                    <span class="user-type">Premium</span>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a href="/logout" class="dropdown-item">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Déconnexion
                                </a>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </header>

    <div class="modern-layout">
        <!-- Sidebar moderne -->
        <aside class="modern-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3 class="nav-title">Découvrir</h3>
                    <ul class="nav-list">
                        <li class="nav-item active">
                            <a href="#" data-section="home" class="nav-link">
                                <i class="fas fa-home"></i>
                                <span>Accueil</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-section="search" class="nav-link">
                                <i class="fas fa-search"></i>
                                <span>Recherche</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-section="local" class="nav-link">
                                <i class="fas fa-hard-drive"></i>
                                <span>Ma Bibliothèque</span>
                                <span class="nav-badge" id="local-count">0</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3 class="nav-title">Bibliothèque</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" data-section="playlists" class="nav-link">
                                <i class="fas fa-list"></i>
                                <span>Playlists</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-section="liked" class="nav-link">
                                <i class="fas fa-heart"></i>
                                <span>Titres likés</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-section="recent" class="nav-link">
                                <i class="fas fa-clock"></i>
                                <span>Récemment joués</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <h3 class="nav-title">Appareils</h3>
                    <div id="devices-modern" class="devices-modern">
                        <div class="loading-modern">Chargement...</div>
                    </div>
                </div>
                
                <div class="nav-section">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" data-section="help" class="nav-link">
                                <i class="fas fa-question-circle"></i>
                                <span>Aide</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="modern-main">
            <!-- Section Accueil -->
            <section id="home-section" class="content-section active">
                <div class="section-header">
                    <h1 class="section-title">Bon retour !</h1>
                    <p class="section-subtitle">Voici ce qui vous attend aujourd'hui</p>
                </div>
                
                <div class="home-grid">
                    <div class="quick-access">
                        <h2>Accès rapide</h2>
                        <div class="quick-items">
                            <div class="quick-item" data-action="liked">
                                <i class="fas fa-heart"></i>
                                <span>Titres likés</span>
                            </div>
                            <div class="quick-item" data-action="recent">
                                <i class="fas fa-clock"></i>
                                <span>Récemment joués</span>
                            </div>
                            <div class="quick-item" data-action="local">
                                <i class="fas fa-hard-drive"></i>
                                <span>Ma bibliothèque</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <h3>Statistiques</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-number" id="spotify-tracks">0</span>
                                <span class="stat-label">Pistes Spotify</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="local-tracks">0</span>
                                <span class="stat-label">Pistes locales</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="total-playlists">0</span>
                                <span class="stat-label">Playlists</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Bibliothèque locale -->
            <section id="local-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Ma Bibliothèque</h1>
                    <div class="section-actions">
                        <button class="btn-primary" id="add-music-btn">
                            <i class="fas fa-plus"></i>
                            Ajouter de la musique
                        </button>
                        <button class="btn-secondary" id="refresh-library-btn">
                            <i class="fas fa-sync-alt"></i>
                            Actualiser
                        </button>
                    </div>
                </div>
                
                <div class="library-controls">
                    <div class="view-controls">
                        <button class="view-btn active" data-view="list">
                            <i class="fas fa-list"></i>
                        </button>

                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                    
                    <div class="sort-controls">
                        <select id="sort-select">
                            <option value="name">Nom</option>
                            <option value="artist">Artiste</option>
                            <option value="album">Album</option>
                            <option value="addedAt">Date d'ajout</option>
                        </select>
                    </div>
                </div>
                
                <div id="local-library" class="music-library">
                    <div class="loading-modern">Chargement de votre bibliothèque...</div>
                </div>
            </section>

            <!-- Section Recherche -->
            <section id="search-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Recherche</h1>
                </div>
                
                <div class="search-tabs">
                    <button class="search-tab active" data-source="all">Tout</button>
                    <button class="search-tab" data-source="spotify">Spotify</button>
                    <button class="search-tab" data-source="local">Ma bibliothèque</button>
                </div>
                
                <div id="search-results-modern" class="search-results-modern">
                    <div class="search-placeholder-modern">
                        <i class="fas fa-search"></i>
                        <p>Recherchez votre musique préférée</p>
                    </div>
                </div>
            </section>

            <!-- Section Playlists -->
            <section id="playlists-section" class="content-section">
                <div class="section-header">
                    <h1 class="section-title">Mes Playlists</h1>
                    <button class="btn-primary" id="create-playlist-modern-btn">
                        <i class="fas fa-plus"></i>
                        Créer une playlist
                    </button>
                </div>
                
                <div id="playlists-modern" class="playlists-modern">
                    <div class="loading-modern">Chargement des playlists...</div>
                </div>
            </section>

            <!-- Section Titres likés - Design Révolutionnaire -->
            <section id="liked-section" class="content-section premium-section">
                <div class="premium-header">
                    <div class="premium-title">
                        <div class="premium-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h2>Titres Likés</h2>
                    </div>
                    <div class="premium-controls">
                        <button class="premium-btn" id="play-liked-btn">
                            <i class="fas fa-play"></i>
                            Lire Tout
                        </button>
                        <button class="premium-btn" id="play-liked-web-btn">
                            <i class="fas fa-headphones"></i>
                            Lecteur Web
                        </button>
                        <button class="premium-btn secondary" id="shuffle-liked-btn">
                            <i class="fas fa-random"></i>
                            Aléatoire
                        </button>
                        <button class="premium-btn neon" id="lyrics-liked-btn">
                            <i class="fas fa-microphone-alt"></i>
                            Paroles
                        </button>
                    </div>
                </div>
                
                <div class="premium-tracks-grid" id="liked-tracks">
                    <div class="premium-empty-state">
                        <div class="premium-empty-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="premium-empty-title">Chargement de vos favoris...</div>
                        <div class="premium-empty-text">Découvrez vos titres likés avec une expérience visuelle révolutionnaire</div>
                    </div>
                </div>
            </section>

            <!-- Section Récemment joués - Design Révolutionnaire -->
            <section id="recent-section" class="content-section premium-section">
                <div class="premium-header">
                    <div class="premium-title">
                        <div class="premium-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h2>Récemment Joués</h2>
                    </div>
                    <div class="premium-controls">
                        <button class="premium-btn secondary" id="refresh-recent-btn">
                            <i class="fas fa-sync-alt"></i>
                            Actualiser
                        </button>
                        <button class="premium-btn neon" id="lyrics-recent-btn">
                            <i class="fas fa-microphone-alt"></i>
                            Paroles
                        </button>
                    </div>
                </div>
                
                <div class="premium-tracks-grid" id="recent-tracks">
                    <div class="premium-empty-state">
                        <div class="premium-empty-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="premium-empty-title">Chargement de l'historique...</div>
                        <div class="premium-empty-text">Redécouvrez vos pistes récentes avec style</div>
                    </div>
                </div>
            </section>
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                    
                    <div class="filter-controls">
                        <select id="recent-limit-select">
                            <option value="20">20 dernières</option>
                            <option value="50" selected>50 dernières</option>
                        </select>
                    </div>
                </div>
                
                <div id="recent-tracks" class="music-library">
                    <div class="loading-modern">Chargement de vos pistes récentes...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Player moderne en bas -->
    <div class="modern-player">
        <div class="player-left">
            <div class="track-image-small">
                <img id="current-track-image" src="" alt="Album" style="width: 56px; height: 56px; border-radius: 4px; object-fit: cover; display: none;">
                <div class="track-image-placeholder" style="width: 56px; height: 56px; border-radius: 4px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; color: var(--spotify-text-gray);">
                    <i class="fas fa-music"></i>
                </div>
            </div>
            <div class="track-info">
                <div class="track-title" id="current-track-name">Sélectionnez une piste</div>
                <div class="track-artist" id="current-track-artist">Aucun artiste</div>
            </div>
            <button class="control-btn" id="like-current-btn" title="Aimer">
                <i class="far fa-heart"></i>
            </button>
        </div>
        
        <div class="player-center">
            <div class="player-controls">
                <button class="control-btn" id="shuffle-btn" title="Lecture aléatoire">
                    <i class="fas fa-random"></i>
                </button>
                <button class="control-btn" id="prev-btn" title="Précédent">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="play-btn" id="play-pause-btn" title="Lecture/Pause">
                    <i class="fas fa-play"></i>
                </button>
                <button class="control-btn" id="next-btn" title="Suivant">
                    <i class="fas fa-step-forward"></i>
                </button>
                <button class="control-btn" id="repeat-btn" title="Répéter">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            
            <div class="progress-container">
                <span class="progress-time" id="time-current">0:00</span>
                <div class="progress-bar" id="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <span class="progress-time" id="time-total">0:00</span>
            </div>
        </div>
        
        <div class="player-right">
            <button class="control-btn" id="queue-btn" title="File d'attente">
                <i class="fas fa-list-ul"></i>
            </button>
            <button class="control-btn" id="devices-btn" title="Appareils">
                <i class="fas fa-desktop"></i>
            </button>
            <div class="volume-container">
                <button class="control-btn" id="volume-btn" title="Volume">
                    <i class="fas fa-volume-up"></i>
                </button>
                <div class="volume-bar" id="volume-bar">
                    <div class="volume-fill" id="volume-fill" style="width: 50%;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Aide -->
    <section id="help-section" class="content-section">
        <div class="section-header">
            <h1 class="section-title">Aide et Dépannage</h1>
            <p class="section-subtitle">Solutions aux problèmes courants</p>
        </div>
        
        <div class="help-content">
            <div class="help-card">
                <div class="help-icon error">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="help-info">
                    <h3>Erreur 404 lors de la lecture</h3>
                    <p>Cette erreur indique qu'aucun appareil Spotify n'est actif.</p>
                    <div class="help-solutions">
                        <h4>Solutions :</h4>
                        <ul>
                            <li>Ouvrez l'application Spotify sur votre téléphone, ordinateur ou tablette</li>
                            <li>Lancez une musique puis mettez en pause</li>
                            <li>Votre appareil apparaîtra dans la liste des appareils disponibles</li>
                            <li>Vous pouvez ensuite contrôler la lecture depuis Spootify Web</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="help-card">
                <div class="help-icon info">
                    <i class="fas fa-music"></i>
                </div>
                <div class="help-info">
                    <h3>Lecture de musique locale</h3>
                    <p>Si Spotify n'est pas disponible, vous pouvez écouter vos fichiers locaux.</p>
                    <div class="help-solutions">
                        <h4>Comment ajouter de la musique :</h4>
                        <ul>
                            <li>Cliquez sur le bouton <i class="fas fa-cloud-upload-alt"></i> dans le header</li>
                            <li>Glissez-déposez vos fichiers audio (MP3, WAV, FLAC, etc.)</li>
                            <li>Ou cliquez pour sélectionner des fichiers</li>
                            <li>Vos fichiers seront disponibles dans "Ma Bibliothèque"</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="help-card">
                <div class="help-icon success">
                    <i class="fas fa-spotify"></i>
                </div>
                <div class="help-info">
                    <h3>Connexion Spotify</h3>
                    <p>Pour une expérience optimale, connectez-vous avec Spotify Premium.</p>
                    <div class="help-solutions">
                        <h4>Avantages Spotify Premium :</h4>
                        <ul>
                            <li>Contrôle complet de la lecture sur tous vos appareils</li>
                            <li>Accès à toute la bibliothèque Spotify</li>
                            <li>Qualité audio supérieure</li>
                            <li>Pas de publicités</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="help-card">
                <div class="help-icon warning">
                    <i class="fas fa-wifi"></i>
                </div>
                <div class="help-info">
                    <h3>Problèmes de connexion</h3>
                    <p>Si vous rencontrez des problèmes de connexion.</p>
                    <div class="help-solutions">
                        <h4>Vérifications :</h4>
                        <ul>
                            <li>Vérifiez votre connexion internet</li>
                            <li>Assurez-vous que Spotify est ouvert sur au moins un appareil</li>
                            <li>Rechargez la page si nécessaire</li>
                            <li>Déconnectez-vous et reconnectez-vous si le problème persiste</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modals -->
    <div id="upload-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ajouter de la musique</h3>
                <button class="modal-close" id="upload-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="upload-area" style="text-align: center; padding: 40px; border: 2px dashed rgba(255,255,255,0.2); border-radius: var(--border-radius); background: rgba(255,255,255,0.05); cursor: pointer; transition: var(--transition);">
                    <div class="upload-icon" style="font-size: 48px; color: var(--spotify-green); margin-bottom: 16px;">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="upload-text" style="font-size: 18px; font-weight: 600; color: var(--spotify-white); margin-bottom: 8px;">Glissez-déposez vos fichiers audio ici</p>
                    <p class="upload-subtext" style="color: var(--spotify-text-gray); margin-bottom: 24px;">ou cliquez pour sélectionner</p>
                    <input type="file" id="file-input" multiple accept="audio/*" hidden>
                    <button class="btn-primary" id="select-files-btn">Sélectionner des fichiers</button>
                </div>
                <div class="upload-progress" id="upload-progress" style="display: none; margin-top: 24px;">
                    <div class="progress-bar" style="height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                        <div class="progress-fill" id="progress-fill-upload" style="height: 100%; background: var(--spotify-green); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                    <p class="upload-status" id="upload-status" style="text-align: center; margin-top: 12px; color: var(--spotify-text-gray);">Téléchargement en cours...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lecteur Audio Web Intégré -->
    <div id="web-audio-player" class="web-player" style="display: none;">
        <div class="web-player-content">
            <div class="web-player-track-info">
                <div class="web-player-cover">
                    <img id="web-player-cover" src="" alt="Cover" />
                    <div class="web-player-cover-placeholder">
                        <i class="fas fa-music"></i>
                    </div>
                </div>
                <div class="web-player-details">
                    <div class="web-player-title" id="web-player-title">Aucune piste sélectionnée</div>
                    <div class="web-player-artist" id="web-player-artist">-</div>
                </div>
            </div>
            
            <div class="web-player-controls">
                <button class="web-player-btn" id="web-player-prev">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="web-player-btn web-player-play-btn" id="web-player-play">
                    <i class="fas fa-play"></i>
                </button>
                <button class="web-player-btn" id="web-player-next">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="web-player-progress">
                <span class="web-player-time" id="web-player-current-time">0:00</span>
                <div class="web-player-progress-bar">
                    <input type="range" id="web-player-progress-slider" min="0" max="100" value="0" class="web-player-slider">
                </div>
                <span class="web-player-time" id="web-player-duration">0:00</span>
            </div>
            
            <div class="web-player-volume">
                <button class="web-player-btn" id="web-player-volume-btn">
                    <i class="fas fa-volume-up"></i>
                </button>
                <div class="web-player-volume-bar">
                    <input type="range" id="web-player-volume-slider" min="0" max="100" value="70" class="web-player-slider">
                </div>
            </div>
        </div>
    </div>

    <!-- Audio player pour les fichiers locaux -->
    <audio id="local-audio-player" preload="metadata"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>